node {
 stage('Checkout') {
  checkout scm
 }
 stage('Environment') {
  sh 'git --version'
  echo "Build number : env.BUILD_NUMBER"
  sh 'docker -v'
  sh 'docker ps'
 }
 stage('Build and Push') {
  withCredentials([string(credentialsId: 'SERVER', variable: 'SERVER')]) {
    withDockerRegistry(credentialsId: 'ecr:us-west-2:aws-cred', url: 'https://${SERVER}') {
    app = docker.build("${SERVER}:${env.BRANCH_NAME}-build-${env.BUILD_NUMBER}")
    app.push()
    }
  }
}
}