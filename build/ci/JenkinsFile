pipeline {
 agent any
 stages{
stage('Checkout') {
  checkout scm
 }
 stage('Environment') {
  steps {
   sh 'git --version'
   echo "Build number : env.BUILD_NUMBER"
   sh 'docker -v'
   sh 'docker ps'
  }
 }
 stage('Build and Push') {
  steps {
   withDockerRegistry(url: 'http://149.91.90.168:5000', credentialsId: 'e56a6c40-97c8-4a3c-afbb-ff7182917c31', ) {
    app = docker.build("registry.labo-devops.ml/boxmetrics-agent:${env.BUILD_NUMBER}")
    app.push()
   }
  }
 }
 }
}