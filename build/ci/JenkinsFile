  node {
    stage('Checkout') {
       checkout scm
    }
    stage('Environment') {
      sh 'git --version'
      echo "Branch: ${env.BRANCH_NAME}"
      echo "Build Number: ${env.BUILD_NUMBER}"
      sh 'docker -v'
    }
    stage('Build and deploy'){
     app = docker.build("149.91.90.168:5000/boxmetrics-agent")
    }
    stage('Build and Deploy'){
        withDockerRegistry( url: 'http://149.91.90.168:5000', credentialsId: '9c14073a-669c-408c-b3d5-ca8255b46dac') {
          app = docker.build("149.91.90.168:5000/testasopcore:${env.BUILD_NUMBER}")
          app.push()
        }   
      }
    }